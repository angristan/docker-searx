pipeline:
  docker-build-publish:
    image: plugins/docker
    dockerfile: Dockerfile
    repo: angristan/searx
    tags: [ "latest", "0.14", "0.14.0" ]
    secrets: [ docker_username, docker_password ]
    when:
      branch: master

pipeline:
  docker-build-test:
    image: plugins/docker
    dockerfile: Dockerfile
    repo: angristan/searx
    tags: [ "test" ]
    secrets: [ docker_username, docker_password ]
    when:
      branch:
        exclude: [ master]

pipeline:
  telegram-notification:
    image: appleboy/drone-telegram
    secrets: [ telegram_token, telegram_to ]
    when:
      status: [ success, failure ]
    format: markdown
    message: >
      {{#success build.status}}
      ✅ Build #{{build.number}} of `{{repo.name}}` succeeded.


      📝 Commit by {{commit.author}} on `{{commit.branch}}`:

      ```
      {{commit.message}}
      ```


      🌐 {{ build.link }}
      {{else}}
      ❌ Build #{{build.number}} of `{{repo.name}}` failed.


      📝 Commit by {{commit.author}} on `{{commit.branch}}`:

      ```
      {{commit.message}}
      ```


      🌐 {{ build.link }}
      {{/success}}
